# Что такое Prometheus

Prometheus - оперсорсная. основанная на метриках  система мониторинга.
Была разработана в компании SoundCloud в 2012 году и передана в CNCF
Написана на языке Go

Существует множество библиотек на разных языках программирования для применения метрик в формате Prometheus. Для тех програмный продуктов, которые не могут формировать метрики в формате Prometheus существуют адаптеры или экспортеры.

Модель данных характеризуется не только  именем метрики, но и неупорядоченным набором  пар ключ-значение. именуемых метками. Язык PromQL позволяет навигироваться по этим меткам, агрегировать их, анализировать тренды.

Prometheus - это по сути статический бинарник, с конфигурационным файлом.

### Что-же такое мониторинг:
* Система раннего предупреждения (Alerting)
* Система для отладки (Debugging)
* Система отслеживания тенденция (Trending)
* Система обработки данных (Plumbing)

## Архитектура Prometheus
prometheus  - опрашивает сервисы и снимает с них определенные срезы. Это может быть реализовано путем инструментирования кода приложения или реализаций 3 приложениями (экспортеры). Собранные срезу сохраняются, и их можно посмотреть  используя язык PromQL или отослать предупреждение в Alert-manager.

*Поставщики метрик*:
* Клиентские библиотеки
* Экспортеры

*Service Discovery* - Prometheus должен знать с каких точек ему необходимо снимать срезы метрик, по этой  причине он обращается к сервисам обнаружения за информацией. Это может быть  k8s , consul, EC2. Prometheus извлекает метаданные сервисов и использует их для конфигурации извлечения срезов и их маркировки.

*Scraping* (снятие срезов). Обозреватель сервисов (Service Discover) и маркировка (reLabeling)  предоставляют информаци с каких узлов и каким способом снимать метрики. Prometheus  - отсылает  http запрос, именуемый scrape. ответ  парсится и сохраняется в TSDB. Скрейпинг регулируется и обычно устанвливается в пределах от 10 до 60 секунд

*Storage*  Prometheus сохраняет данные в локальное хранилище типа TSDB. Оно не имеет кластеризации, но может принимать милионы метрик в секунду.  В среднем компресия дает 1.3 байта на 1 метрику и не требует SSD.

*Dashboards* Prometheus предоставляет WEB интерфейс для отображения  запросов PromQL, но это решение не является системным. Рекомендуется использовать отдельное решение  - Grafana

*Recording Rules and Alerts* Несмотря на то. что метрики Prometheus записывает быстро, они все же немного отстают - и для этого можно применять пред-агрегацию, и записывать их в хранилище. Правила   Alerts - это также способ пред-агрегации,  но резульатыт работы уже передаются Alertmanager.


*Alert Management*. Алертменеджер получает информацию от Prometheus сервера и производит нотификацию - оповещения  через электронную почту, чаты и другие средства.
Алертменеджер умееет агрегировать информацию. тем самым позволяет избежать шторма оповещений.
Алерты и пороги настраиваются в Prometheus сервере, не в Alertmanager.

*Long-Term Storage*. Локальное хранилище Prometheus не предназначено для долговременного хранения метрик. Для долгосрочного хранения необходимо позаботится самостоятельно.