#  Метки (Labels) 
Метки, важная часть Prometheus. 

## *Что такое метки*
Метки, представляют собой кортежи в виде ключ-значение. Например чтобы не плодить однотипные метрики по HTTP  запросам, можно создать одну, и для дифференциации по Path  добавить их различие 
~~~
http_requests_total{path="/login"}
~~~  

С помощью языка PromQL  далее можно объединять и фильтровать метрики по меткам, рассматривая  как единое целое.


## *Инструментирование и целеуказание меток*
Метки бывают 2 видов:
* инструментированные метки
* метки целевого хоста

Инструментированные метки - создаются в библиотеках и приложениях.
Метки целевого хоста - добавляются Prometheus,   как часть процесса сбора метрик. Различные  Prometheus сервера могут иметь свои представления.

### Инструментирование


~~~ python
 REQUESTS.labels(self.path).inc() # <-- вот тут метка
~~~

Предпочтительно не включать в имя  метрики  ключевые значения, совпадающие с  метриками целевых точек.
Метрики имеют текстовое имя  в формате UTF-8.
Имена начинающиеся на 2 подчеркивания зарезервированы , например __name__


### Множество метрик
Метрик может быть указано большое количество раз -
~~~ python
REQUESTS.labels(self.path, self.command).inc()
~~~

### Агрегация
В PromQL существуют операторы позволяющие вывдвать агрегированную информацию по метрикам с учетом\без учета меток.
Например 
~~~ 
rate(hello_worlds_total[5m])
~~~ 
выдаёт все метрики по условиям,
~~~ 
 sum without(path)(rate(hello_worlds_total[5m]))
~~~ 
Результаты  схлопнутся без учета метки  *path*

~~~ 
sum without(path, instance)(rate(hello_worlds_total[5m]))
~~~ 
Результаты  схлопнутся без учета метки  *path* и *instance*

## Шаблоны меток
Prometheus поддерживает формат значений только 64 битные плавающей точности числа.
Одним из решений ситуации, является включением состав меток Перечислений (Enum)
~~~  PromQL
# HELP gauge The current state of resources.# TYPE gauge resource_stateresource_state{resource_state="STARTING",resource="blaa"} 0resource_state{resource_state="RUNNING",resource="blaa"} 1
~~~ 

Другим подходом является использование меток, как часть информации об окружении. Например 
~~~
# HELP python_info Python platform information# TYPE python_info gaugepython_info{implementation="CPython",major="3",minor="5",patchlevel="2",        version="3.5.2"} 1.0
~~~
Для такой реализации. необходимо  или  вручную снабдить код метриками или использовать кастомные коллекторы.


 ## Когда использовать метки
 К меткам надо подходить со смыслом - каждая из них должна нести информацию о части, из сумм которых можно сложить картину, происходящую в системе.

 Не следует, вводить двойной учет - напрмиер отдельная метрика с суммой частей не имеет смысла.


### Цена мониторинга
Мониторинг не бесплатная вещь из коробки - за длинные серии данных, приходится платить вычислительными ресурсами, будь то облако или сервера и человеческими затратами на создание и поддержание среды.